<!-- templates/user_dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Flood Prediction System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
    body{
        background-color: rgb(6, 6, 6);
    }

</style>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">Flood Prediction System</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">Logged in as: {{ user }}</span>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <h2 class="mb-4" style="color: white;">User Dashboard - {{ city }}</h2>
                
                <div class="row mb-4">
                    <div class="col-md-12">
                        <form class="row g-3" action="{{ url_for('user_dashboard') }}">
                            <div class="col-md-6">
                                <label for="city" class="form-label" style="color: white;">Search Other Cities</label>
                                <select class="form-select" id="city" name="city">
                                    <option value="Nellore" {{ 'selected' if city == 'Nellore' }}>Nellore</option>
                                    <option value="Amritsar" {{ 'selected' if city == 'Amritsar' }}>Amritsar</option>
                                    <option value="Delhi" {{ 'selected' if city == 'Delhi' }}>Delhi</option>
                                    <option value="Tirupati" {{ 'selected' if city == 'Tirupati' }}>Tirupati</option>
                                    <option value="Puttur" {{ 'selected' if city == 'Puttur' }}>Puttur</option>
                                </select>
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary">Search</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="row">
<!-- Dam Information -->
    <div class="col-md-6 mb-4">
    <div class="card h-100 animate__animated animate__fadeInLeft" style="border-radius: 15px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.3);">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #11998e, #38ef7d);">
            <h5>Dam Information</h5>
        </div>
        <div class="card-body">
        {% if dam_data %}
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
            <div class="card text-white p-3 mb-4 animate__animated animate__fadeInUp" style="background: linear-gradient(135deg, #1e3c72, #2a5298); border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); transition: transform 0.3s;">
                <div class="card-body">
                    <h4 class="card-title mb-3"><i class="fas fa-water"></i> {{ dam_data[1] }}</h4>
                    <h6 class="card-subtitle mb-3">{{ dam_data[2] }}</h6>
                    
                    <!-- Circular progress for current level -->
                    {% set percentage = (dam_data[3] / dam_data[4] * 100) | round(1) %}
                    <div class="d-flex justify-content-center mb-4">
                        <svg width="120" height="120">
                            <circle cx="60" cy="60" r="50" stroke="#ccc" stroke-width="10" fill="none"/>
                            <circle cx="60" cy="60" r="50" 
                                    stroke="{% if percentage > 90 %}#ff4d4d{% elif percentage > 70 %}#ffd11a{% else %}#4dff88{% endif %}" 
                                    stroke-width="10" fill="none"
                                    stroke-dasharray="{{ 2 * 3.1416 * 50 }}"
                                    stroke-dashoffset="{{ 2 * 3.1416 * 50 * (1 - percentage / 100) }}"
                                    stroke-linecap="round"
                                    transform="rotate(-90 60 60)"/>
                            <text x="50%" y="50%" text-anchor="middle" dy="8" font-size="18" fill="white">{{ percentage }}%</text>
                        </svg>
                    </div>

                    <div class="row text-center mb-3">
                        <div class="col">
                            <i class="fas fa-tint fa-2x"></i>
                            <p class="mb-0">{{ dam_data[5] }} m¬≥/s</p>
                            <small>Inflow</small>
                        </div>
                        <div class="col">
                            <i class="fas fa-water fa-2x"></i>
                            <p class="mb-0">{{ dam_data[6] }} m¬≥/s</p>
                            <small>Outflow</small>
                        </div>
                        <div class="col">
                            <i class="fas fa-hand-holding-water fa-2x"></i>
                            <p class="mb-0">{{ 'Yes' if dam_data[7] == 1 else 'No' }}</p>
                            <small>Water Released</small>
                        </div>
                    </div>

                    <p class="text-end mb-0"><small>Last Updated: {{ dam_data[8] }}</small></p>
                </div>
            </div>
        {% else %}
            <div class="alert alert-warning animate__animated animate__shakeX">
                No dam data available for this city.
            </div>
        {% endif %}
        </div>
    </div>
</div>

<!-- Weather Information -->
<div class="col-md-6 mb-4" >
    <div class="card h-100 animate__animated animate__fadeInRight" style="border-radius: 15px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.3);">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #11998e, #38ef7d);" >
            <h5>Weather Information</h5>
        </div>
        <div class="card-body" style="background-color: rgb(41, 4, 35);">
        {% if weather_data and not weather_data.error %}
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
            <div class="row g-4 mt-3">
                {% set colors = [
                    'linear-gradient(135deg, #6DD5FA, #2980B9)',
                    'linear-gradient(135deg, #56ab2f, #a8e063)',
                    'linear-gradient(135deg, #f7971e, #ffd200)',
                    'linear-gradient(135deg, #ff6a00, #ee0979)',
                    'linear-gradient(135deg, #41295a, #2F0743)'
                ] %}
                
                <div class="col-md-4">
                    <div class="card text-center animate__animated animate__fadeInUp" style="height: 180px; background: {{ colors[1] }}; color: white; transition: transform 0.3s;">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">‚òÄÔ∏è Temperature</h5>
                            <p class="card-text display-6">{{ weather_data.temperature }}¬∞C</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4" >
                    <div class="card text-center animate__animated animate__fadeInUp animate__delay-1s" style="height: 180px; background: {{ colors[1] }}; color: white; transition: transform 0.3s;">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">üíß Humidity</h5>
                            <p class="card-text display-6">{{ weather_data.humidity }}%</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center animate__animated animate__fadeInUp animate__delay-2s" style="height: 180px; background: {{ colors[1] }}; color: white; transition: transform 0.3s;">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">‚òÅÔ∏è Conditions</h5>
                            <p class="card-text display-6" style="font-size: 20px;">{{ weather_data.description }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card text-center animate__animated animate__fadeInUp animate__delay-3s" style="height: 180px; background: {{ colors[1] }}; color: white; transition: transform 0.3s;">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">üåßÔ∏è Rainfall (last hour)</h5>
                            <p class="card-text display-6">{{ weather_data.rainfall }} mm</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card text-center animate__animated animate__fadeInUp animate__delay-4s" style="height: 180px; background: {{ colors[1] }}; color: white; transition: transform 0.3s;">
                        <div class="card-body d-flex flex-column justify-content-center">
                            <h5 class="card-title">üå¶Ô∏è Rainfall (last 3 hours)</h5>
                            <p class="card-text display-6">{{ weather_data.rainfall3hr }} mm</p>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="alert alert-danger animate__animated animate__shakeX" role="alert">
                Weather data not available.
            </div>
            <div class="text-muted">
                Note: To get real weather data, you need to add a valid OpenWeatherMap API key.
            </div>
        {% endif %}
        </div>
    </div>
</div>

  <!-- Flood Prediction -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card" style="width: 102%;">
            <div class="card-header 
                {% if prediction.risk == 'Low' %}bg-success
                {% elif prediction.risk == 'Moderate' %}bg-warning
                {% elif prediction.risk == 'High' %}bg-danger
                {% elif prediction.risk == 'Severe' %}bg-danger
                {% else %}bg-secondary{% endif %} text-white">
                <h5>Flood Prediction Accoding to Our ML Model</h5>
            </div>
            <div class="card-body">
                <h4>Risk Level: 
                    <span class="
                        {% if prediction.risk == 'Low' %}text-success
                        {% elif prediction.risk == 'Moderate' %}text-warning
                        {% elif prediction.risk == 'High' %}text-danger
                        {% elif prediction.risk == 'Severe' %}text-danger
                        {% else %}text-secondary{% endif %}">
                        {{ prediction.risk }} ({{ prediction.severity }})
                    </span>
                </h4>
                <p class="lead">{{ prediction.message }}</p>

                {% if prediction.risk == 'High' or prediction.risk == 'Severe' %}
                <div class="alert alert-danger mt-3">
                    <h6>Safety Recommendations:</h6>
                    <ul>
                        <li>Stay tuned to local news and weather reports</li>
                        <li>Prepare an emergency kit with essential supplies</li>
                        <li>Know your evacuation route if needed</li>
                        <li>Move to higher ground if advised by authorities</li>
                        <li>Avoid walking or driving through flood waters</li>
                    </ul>
                </div>
                {% elif prediction.risk == 'Moderate' %}
                <div class="alert alert-warning mt-3">
                    <h6>Precautionary Measures:</h6>
                    <ul>
                        <li>Monitor water levels regularly</li>
                        <li>Be prepared to take action if conditions worsen</li>
                        <li>Keep important documents in a waterproof container</li>
                        <li>Have a plan for relocating if necessary</li>
                    </ul>
                </div>
                {% else %}
                <div class="alert alert-success mt-3">
                    <h6>Current Status:</h6>
                    <ul>
                        <li>No immediate flood threat</li>
                        <li>Continue to monitor conditions during heavy rainfall</li>
                        <li>Stay informed about weather forecasts</li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
